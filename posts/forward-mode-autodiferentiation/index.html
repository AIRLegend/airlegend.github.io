<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="The magic behind (forward mode) Automatic Differentiation" /><meta name="author" content="Alvaro" /><meta property="og:locale" content="en" /><meta name="description" content="Demystifying Automatic Differentiation" /><meta property="og:description" content="Demystifying Automatic Differentiation" /><link rel="canonical" href="https://airlegend.github.io/posts/forward-mode-autodiferentiation/" /><meta property="og:url" content="https://airlegend.github.io/posts/forward-mode-autodiferentiation/" /><meta property="og:site_name" content="Alvaro‚Äôs blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-03-18T04:33:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="The magic behind (forward mode) Automatic Differentiation" /><meta name="twitter:site" content="@aalvaroir" /><meta name="twitter:creator" content="@Alvaro" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Alvaro"},"dateModified":"2022-04-14T21:28:17+02:00","datePublished":"2022-03-18T04:33:00+01:00","description":"Demystifying Automatic Differentiation","headline":"The magic behind (forward mode) Automatic Differentiation","mainEntityOfPage":{"@type":"WebPage","@id":"https://airlegend.github.io/posts/forward-mode-autodiferentiation/"},"url":"https://airlegend.github.io/posts/forward-mode-autodiferentiation/"}</script><title>The magic behind (forward mode) Automatic Differentiation | Alvaro's blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Alvaro's blog"><meta name="application-name" content="Alvaro's blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars.githubusercontent.com/u/9653892?v=4 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Alvaro's blog</a></div><div class="site-subtitle font-italic">Notes on projects and ideas</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/AIRLegend" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/aalvaroir" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['alvaroibrain','outlook.es'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>The magic behind (forward mode) Automatic Differentiation</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>The magic behind (forward mode) Automatic Differentiation</h1><div class="post-meta text-muted"><div> By <em> Alvaro </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1647574380" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-03-18 </em> </span> <span> Updated <em class="timeago" data-ts="1649964497" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2022-04-14 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1429 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><h1 id="demystifying-automatic-differentiation">Demystifying Automatic Differentiation</h1><hr /><p>If you recall from highschool you‚Äôll probably remember the definition of a derivative:</p>\[\begin{equation} f'(x) = \lim_{\epsilon \rightarrow 0} \frac{f(x+\epsilon) - f(x)}{\epsilon} \label{eq:deriv} \end{equation}\]<p>Which is the same as saying: ‚Äúwhat‚Äôs the slope of the line which crosses $f(x)$ and $f(x + \epsilon)$?‚Äù:</p><p><img data-src="https://i.imgur.com/H9fAq1e.png" alt="derivativeSlope" data-proofer-ignore></p><p>This $\epsilon$ is really a perturbation, a small amount of ‚Äúnoise‚Äù that is added to $x$ in order to calculate the slope.</p><p>What the $\lim_{\epsilon \rightarrow 0}$ tell us is that the smallest $\epsilon$ is, the more accurate will be our calculation of $f‚Äô(x)$.</p><p>Ideally, if we had infinitely precise computers, it wouldn‚Äôt be a bad idea to use this method for computing derivatives. Unfortunately, this is not the case. We start having (big) problems as long as we keep reducing $\epsilon$.</p><h2 id="how-does-a-computer-read-numbers"><span class="mr-2">How does a computer read numbers?</span><a href="#how-does-a-computer-read-numbers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Why is that? Why we cannot simply reduce $\epsilon$ as far as we want?</p><blockquote><p><strong>TL;DR</strong> The number of bits we have for representing numbers is finite, so, inevitably, we incur in <strong>rounding errors</strong> which create great numerical instability.</p></blockquote><p>Computers use the <a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE 754 standard</a> for representing floating point numbers (i.e. numbers in $\mathbb{R}$). For example, with 32 bits, a number is represented in the following way:</p><p><img data-src="https://i.imgur.com/q8fVi0q.png" alt="Floating point representation" data-proofer-ignore></p><p>This limits out ‚Äúresolution‚Äù to about $10^{-126}$, which is the smallest absolute number (apart from $0$) we can represent.</p><p>Simplifying with an example. Imagine we only have bits for representing up to two significative figures. If we, for example had $\epsilon=0.25$ and we wanted to calculate $\frac{\epsilon}{2} = 0.125$, which is not representable with two decimals, we thus would have to round, having $\epsilon=0.13$.</p><p>As you see, we would have introduced an error of $0.005$ ($= 2\%$ w.r.t. the true value). It isn‚Äôt difficult to imagine this same error repeating when we have 32 bits. (Obviously, this error will also happen if we use larger numbers like 64 or 128 bit floats, but later).</p><p>Another problem arises when we compute the derivative using the aforementioned formula $\eqref{eq:deriv}$. Typically, in comparison, the numerator quantity ($f(x+\epsilon) - f(x)$) will be much larger than the denominator ($\epsilon$). In a nutshell, this is also bad regarding roundoff errors.</p><p>A possible mitigation for these type of errors could be using two numbers at once: one for the <em>non-epsilon</em> related parts of the computation and other for the things which involve epsilon. In other words, separating the perturbation-related computations from the rest.</p><h2 id="how-math-solves-our-problem-enter-the-dual-numbers"><span class="mr-2">How math solves our problem: Enter the Dual Numbers</span><a href="#how-math-solves-our-problem-enter-the-dual-numbers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>So, two numbers at once‚Ä¶ Doesn‚Äôt that sound like imaginary numbers? ($a+ ib; a,b \in \mathbb{R}$). Quite a bit, they‚Äôre 2-dimensional numbers which we operate segregated by dimension (i.e. the imaginary part $i$ never interacts with the real part $a$).</p><p>As with imaginary numbers, when mathematicians face problems, they tend to construct crazy (but ingenuous nonetheless) settings in which their problems can be easily solved. This is the case of a branch of mathematics called <em>Smooth Infinitesimal Analysis</em>, from where the concept of <a href="https://en.wikipedia.org/wiki/Dual_number"><strong>Dual Numbers</strong></a> arise.</p><p>Dual numbers are an extension to the real numbers and they‚Äôre similar to the imaginary ones in the sense that both have ‚Äú2 dimensions‚Äù which are independent.</p><p>A dual number takes the form of</p>\[a + b \epsilon;\hspace{1em} a, b \in \mathbb{R}\]<p>with the property that $\epsilon$ is <em>nilponent</em>, which in layman‚Äôs terms means $\epsilon^2 = 0$.</p><blockquote><p>Although it can seem that Dual and Imaginary numbers are related, this is not the case. Dual numbers are meant to work with calculus involving really, really small numbers. As simple as I can explain it (probably not rigorous): The reason why $\epsilon^2 = 0$ is that if you take the square of a really really small number, it becomes so small that we can basically consider it 0.</p></blockquote><h3 id="wait-you-were-talking-about-derivatives"><span class="mr-2">Wait, you were talking about derivatives</span><a href="#wait-you-were-talking-about-derivatives" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Indeed. Dual numbers, being an extension of reals, allow us to compute both the evaluation of a function $f(x)$ and its derivative $f‚Äô(x)$ in one run!</p><p>But, how? Let‚Äôs see an example.</p><p>Consider a polynomial series:</p>\[P(x) = p_0 + p_1 x + p_2 x^2 + p_3 x^3 + ... + p_n x^n\]<p>If we plug $x = a + b\epsilon$, see what happens:</p>\[P(a+b\epsilon) = p_0 + p_1 (a+b\epsilon) + p_2 (a+b\epsilon)^2 + p_3 (a+b\epsilon)^3 + ... + p_n (a+b\epsilon)^n\]<p>Expanding and reordering the terms‚Ä¶</p>\[P(a+b\epsilon) = p_0 + p_1 a + p_2 a^2 + p_n a^n \fcolorbox{black}{red}{+} p_1 b\epsilon + 2p_2ab\epsilon + 3 p_3a^2b\epsilon + np_n a^{n-1}b\epsilon\]<p>Note how the original $P(x)$ evaluation is on the left of the red $\fcolorbox{black}{red}{+}$ while on the right is $P‚Äô(x)b\epsilon$. ü§Ø</p><p>Naturally, this effect extends to Taylor series</p><blockquote><p>For those of you who don‚Äôt remember what a Taylor series is. It‚Äôs a way of approximating functions around a point $p$ using the derivatives of the same function. They look like: $f(x) = f(x) + \frac{f‚Äô(a)}{1!}(x - p) + \frac{f^{\prime\prime}(a)}{2!}(x - p)^2 + ‚Ä¶ + \frac{f^n(a)}{n!}(x - p)^n$. If you want to learn more about them, I‚Äôll refer you to this wonderful <a href="https://www.youtube.com/watch?v=3d6DsjIBzJ4">3Blue1Brown video</a>.</p></blockquote>\[f(a+b\epsilon) = f(a) + f^\prime (a)b\epsilon + \frac{f^{\prime\prime}(a)}{2!}(b^2 \epsilon^2) + \frac{f^{\prime\prime\prime}(a)}{3!}(b^3 \epsilon^3) + ...\]<p>The nice thing is that by definition $\epsilon^2 = 0$, so all the terms on the series $&gt;=2$ become 0. Leaving us simply with:</p>\[f(a+b\epsilon) = f(a) + f^\prime (a)b\epsilon\]<p><em>(<strong>Note</strong>: In our case, the value of $b$ doesn‚Äôt interest us, so from now on, $b=1$)</em></p><p>This, in turn, makes us able to operate functions and still have the evaluation and derivative parts separated!</p><p>If we have two functions $f$ and $g$,</p>\[\begin{align*} f: f(a) + \epsilon f^\prime(a) \\ g: g(a) + \epsilon g^\prime(a) \end{align*}\]<p>we can operate them as:</p>\[\begin{align*} f + g = \big[ f(a) + g(a) \big] + \epsilon \big[ f'(a) + g'(a) \big]\\ f \cdot g = \big[ f(a) \cdot g(a) \big] + \epsilon \big[ f(a) \cdot g'(a) + g(a) \cdot f'(a) \big] \end{align*}\]<p class="image-caption">(<em>the above comes from operating the Taylor expansions using the algebra of dual numbers</em>).</p><p>Let‚Äôs see a real example using this mathematical tool.</p><p>Let $f(x) = 3x^2 + x + 1$. We now that it‚Äôs true derivative is $f‚Äô(x) = 6x + 1$.</p><p>Applying the dual number method we‚Äôve just talked about, we have:</p>\[\begin{align*} f(a + \epsilon) &amp;=&amp; 3(a + \epsilon)^2 + (a + \epsilon) + 1 \\ &amp;=&amp; 3(a^2 + \cancelto{0}{\epsilon^2} + 2a\epsilon) + a + \epsilon + 1 \\ &amp;=&amp; 3a^2 + a + 1 + 6a\epsilon + \epsilon\\ &amp;=&amp; \underbrace{(3a^2 + a + 1)}_{f(a) \text{part}} \fcolorbox{black}{red}{+} \underbrace{\epsilon(6a + 1)}_{f'(a) \text{part}} \end{align*}\]<p>Then, we just have to substitute $a$ for the specific value we want and we get both the function evaluation and its derivative at the point $a$!</p><p>ü§Ø</p><h2 id="math-is-cool-but-how-can-i-implement-this"><span class="mr-2">Math is cool, but how can I implement this?</span><a href="#math-is-cool-but-how-can-i-implement-this" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Ok. Let‚Äôs implement a (<em>very simple</em>) automatic differentiation engine using dual numbers. First, we need to define what is a <code class="language-plaintext highlighter-rouge">DualNumber</code>, using a class.</p><div class="language-python highlighter-rouge"><div class="code-header"><span> </span><button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">DualNumber</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">real_part</span><span class="p">,</span> <span class="n">dual_part</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">real</span> <span class="o">=</span> <span class="n">real_part</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dual</span> <span class="o">=</span> <span class="n">dual_part</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">real</span><span class="si">}</span><span class="s"> + </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">dual</span><span class="si">}</span><span class="s">œµ"</span>
</pre></table></code></div></div><p>Having defined the <code class="language-plaintext highlighter-rouge">__repr__</code> method we can see more clearly what is inside of a <code class="language-plaintext highlighter-rouge">DualNumber</code> object:</p><div class="language-python highlighter-rouge"><div class="code-header"><span> </span><button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="n">DualNumber</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"><span> </span><button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>2 + 3œµ
</pre></table></code></div></div><p>Then, in order to do anything useful,this dual number class must support the arithmetic operations we defined above.</p><p>(<em>In order to keep things simple I will only implement addition. The class would look as follows</em>)</p><div class="language-python highlighter-rouge"><div class="code-header"><span> </span><button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">class</span> <span class="nc">DualNumber</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">real_part</span><span class="p">,</span> <span class="n">dual_part</span><span class="p">):</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">real</span> <span class="o">=</span> <span class="n">real_part</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">dual</span> <span class="o">=</span> <span class="n">dual_part</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">DualNumber</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">DualNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">real</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="n">real</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">dual</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="n">dual</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">DualNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">real</span> <span class="o">+</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">dual</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">TypeError</span><span class="p">(</span><span class="s">"Cannot add that to a dual number!"</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># This is for when we do things like: 10 + DualNumber()
</span>        <span class="k">return</span> <span class="n">DualNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">real</span> <span class="o">+</span> <span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">dual</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">real</span><span class="si">}</span><span class="s"> + </span><span class="si">{</span><span class="bp">self</span><span class="p">.</span><span class="n">dual</span><span class="si">}</span><span class="s">œµ"</span>
</pre></table></code></div></div><p>Let‚Äôs define a $sin$ function which can accept with <code class="language-plaintext highlighter-rouge">DualNumber</code>s</p><div class="language-python highlighter-rouge"><div class="code-header"><span> </span><button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">DualNumber</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DualNumber</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">real</span><span class="p">),</span> <span class="n">np</span><span class="p">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">real</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">.</span><span class="n">dual</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></table></code></div></div><p>With al the above done, we can evaluate $sin(x)$ and $sin‚Äô(x)$ in one single run!</p><div class="language-python highlighter-rouge"><div class="code-header"><span> </span><button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="n">func_evals</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">deriv_evals</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xticks</span><span class="p">:</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">DualNumber</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">func_evals</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">real</span><span class="p">)</span>
    <span class="n">deriv_evals</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">dual</span><span class="p">)</span>

<span class="c1"># visualize the function and its derivative
</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
<span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">func_evals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"sin(x)"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">deriv_evals</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">"sin'(x)"</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="n">legend</span><span class="p">()</span>
</pre></table></code></div></div><p><img data-src="https://i.imgur.com/Up7yySN.png" alt="derivative" data-proofer-ignore></p><p>Although it‚Äôs still necessary to add support for the other operations (<code class="language-plaintext highlighter-rouge">sub</code>, <code class="language-plaintext highlighter-rouge">mult</code>, <code class="language-plaintext highlighter-rouge">div</code>, ‚Ä¶), it‚Äôs pretty impressive for this few lines, right?</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='//categories/ml/'>ML</a>, <a href='//categories/deep-learning/'>Deep Learning</a>, <a href='//categories/maths/'>Maths</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="//tags/maths/" class="post-tag no-text-decoration" >maths</a> <a href="//tags/programming/" class="post-tag no-text-decoration" >programming</a> <a href="//tags/python/" class="post-tag no-text-decoration" >python</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=The+magic+behind+%28forward+mode%29+Automatic+Differentiation+-+Alvaro%27s+blog&url=https%3A%2F%2Fairlegend.github.io%2Fposts%2Fforward-mode-autodiferentiation%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=The+magic+behind+%28forward+mode%29+Automatic+Differentiation+-+Alvaro%27s+blog&u=https%3A%2F%2Fairlegend.github.io%2Fposts%2Fforward-mode-autodiferentiation%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fairlegend.github.io%2Fposts%2Fforward-mode-autodiferentiation%2F&text=The+magic+behind+%28forward+mode%29+Automatic+Differentiation+-+Alvaro%27s+blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/dreambooth/">How I generated professional headshots for my LinkedIn profile</a><li><a href="/posts/openchords/">The AI Coder: Building a website using AI</a><li><a href="/posts/lcm/">Latent Consistency Models: How to speedup image generation</a><li><a href="/posts/ai-development/">Some thoughts on the usage of AI for developing software: Is the end near?</a><li><a href="/posts/forward-mode-autodiferentiation/">The magic behind (forward mode) Automatic Differentiation</a></ul></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/diffusion-models/"><div class="card-body"> <em class="timeago small" data-ts="1656646380" > 2022-07-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Intro to Diffusion Models</h3><div class="text-muted small"><p> On Diffusion Models In this post I‚Äôm going to cover an introduction to Diffusion Models (as I don‚Äôt consider myself an expert on them) by summarizing Ho et al (2020). ‚ÄúDenoising Diffusion Probabi...</p></div></div></a></div><div class="card"> <a href="/posts/lora/"><div class="card-body"> <em class="timeago small" data-ts="1698636780" > 2023-10-30 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>LoRA: How can I tune my model without an expensive GPU?</h3><div class="text-muted small"><p> Training neural networks can be really tedious. Both in terms of methodological complexity ‚Äì tuning hyperparameters, syncing training runs, scheduling learning rates, etc. ‚Äì and also hardware requi...</p></div></div></a></div><div class="card"> <a href="/posts/dreambooth/"><div class="card-body"> <em class="timeago small" data-ts="1700274780" > 2023-11-18 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How I generated professional headshots for my LinkedIn profile</h3><div class="text-muted small"><p> The other day I was bored, wandering through LinkedIn and realized that I probably needed some new profile pics. You know, the ones very corporate-guys share on their posts. Something cool with a s...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <span class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></span> <a href="//posts/diffusion-models/" class="btn btn-outline-primary" prompt="Newer"><p>Intro to Diffusion Models</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> ¬© 2023 <a href="https://twitter.com/aalvaroir">Alvaro</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/programming/">programming</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/maths/">maths</a> <a class="post-tag" href="/tags/pytorch/">pytorch</a> <a class="post-tag" href="/tags/ai/">ai</a> <a class="post-tag" href="/tags/coding/">coding</a> <a class="post-tag" href="/tags/gpt/">gpt</a> <a class="post-tag" href="/tags/cv/">cv</a> <a class="post-tag" href="/tags/image/">image</a> <a class="post-tag" href="/tags/vision/">vision</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { inlineMath: [ /* start/end delimiter pairs for in-line math */ ['$','$'], ['\\(','\\)'] ], displayMath: [ /* start/end delimiter pairs for display math */ ['$$', '$$'], ['\\[', '\\]'], ], tags: 'ams' } }; // MathJax = { // tex: { // inlineMath: [ /* start/end delimiter pairs for in-line math */ // ['$','$'], // ['\\(','\\)'] // ], // displayMath: [ /* start/end delimiter pairs for display math */ // ['$$', '$$'], // ['\\[', '\\]'] // ] // }, // chtml: { // scale: 1.2, // global scaling factor for all expressions // }, // svg: { // minScale: .7, // }, // options: { // enableMenu: true, // set to false to disable the menu // menuOptions: { // settings: { // zoom: 'DoubleClick', // zscale: '300%', // zoom scaling factor // texHints: true, // collapsible: false, // true if complex math should be collapsible // explorer: false, // true if the expression explorere should be active // } // } // } // }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
